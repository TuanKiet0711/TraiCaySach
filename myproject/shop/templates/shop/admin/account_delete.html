{% extends "shop/admin/base_admin.html" %}
{% block title %}Xóa tài khoản{% endblock %}
{% block page_title %}Xóa tài khoản{% endblock %}

{% block content %}
<div class="card border-danger shadow-sm">
  <div class="card-body">
    <h5 class="text-danger mb-3">Bạn chắc chắn muốn xóa tài khoản này?</h5>
    <p class="text-muted">Thao tác này không thể hoàn tác.</p>

    <dl class="row mb-3">
      <dt class="col-sm-3">ID</dt>
      <dd class="col-sm-9"><code class="small">{{ account_id }}</code></dd>

      <dt class="col-sm-3">Họ tên</dt>
      <dd class="col-sm-9" id="accHoTen">Đang tải…</dd>

      <dt class="col-sm-3">Email</dt>
      <dd class="col-sm-9" id="accEmail">—</dd>

      <dt class="col-sm-3">SĐT</dt>
      <dd class="col-sm-9" id="accSdt">—</dd>

      <dt class="col-sm-3">Vai trò</dt>
      <dd class="col-sm-9" id="accRole">—</dd>
    </dl>

    <div class="d-flex gap-2">
      <button id="btnDelete" class="btn btn-danger">
        <i class="bi bi-trash me-1"></i> Xóa
      </button>
      <a href="{% url 'shop:admin_accounts' %}" class="btn btn-secondary">Hủy</a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(async function(){
  const id="{{ account_id }}";
  const $=id=>document.getElementById(id);
  function badgeRole(r){return r==='admin'
    ?'<span class="badge bg-danger">admin</span>'
    :'<span class="badge bg-secondary">customer</span>';}

  // nạp chi tiết tài khoản
  try{
    const res=await fetch(`/api/accounts/${id}/`);
    if(res.ok){
      const data=await res.json();
      $('accHoTen').textContent=data.ho_ten||'(Không có)';
      $('accEmail').textContent=data.email||'—';
      $('accSdt').textContent=data.sdt||'—';
      $('accRole').innerHTML=badgeRole(data.vai_tro||'');
    }else{
      $('accHoTen').textContent='Không tìm thấy';
      $('accEmail').textContent='—';
      $('accSdt').textContent='—';
      $('accRole').textContent='—';
    }
  }catch(e){
    $('accHoTen').textContent='Lỗi tải dữ liệu';
  }

  // Xóa tài khoản
  document.getElementById('btnDelete').addEventListener('click',async()=>{
    if(!confirm('Bạn có chắc muốn xóa tài khoản này?'))return;
    const res=await fetch(`/api/accounts/${id}/`,{
      method:'DELETE',
      headers:{'X-CSRFToken':getCookie('csrftoken')}
    });
    if(res.ok){
      window.location.href="{% url 'shop:admin_accounts' %}";
    }else{
      const data=await res.json().catch(()=>({}));
      alert(data.error||'Lỗi xóa tài khoản');
    }
  });

  function getCookie(name){
    let v=null;
    if(document.cookie)for(let c of document.cookie.split(';')){
      c=c.trim();
      if(c.startsWith(name+'=')){v=decodeURIComponent(c.split('=')[1]);break}
    }
    return v;
  }
})();
</script>
{% endblock %}
